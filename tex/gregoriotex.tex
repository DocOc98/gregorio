% GregorioTeX boostrap file for Plain TeX
%
% Copyright (C) 2015 The Gregorio Project (see CONTRIBUTORS.md)
%
% This file is part of Gregorio.
%
% Gregorio is free software: you can redistribute it and/or modify
% it under the terms of the GNU General Public License as published by
% the Free Software Foundation, either version 3 of the License, or
% (at your option) any later version.
%
% Gregorio is distributed in the hope that it will be useful,
% but WITHOUT ANY WARRANTY; without even the implied warranty of
% MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
% GNU General Public License for more details.
%
% You should have received a copy of the GNU General Public License
% along with Gregorio.  If not, see <http://www.gnu.org/licenses/>.

% this file contains definitions for lines, initial, fonts, etc.

\edef\greoldcatcode{\the\catcode`@}
\catcode`\@=11

\input ifluatex.sty%
\input luatexbase.sty%
\input luaotfload.sty%
\input graphicx.tex % for \resizebox
\input xstring.sty%
\def\greerror#1{\errmessage{GregorioTeX error: #1}}%
\def\gre@warning#1{\message{GregorioTeX warning: #1}}%
\def\gre@bug#1{\errmessage{GregorioTeX bug: #1 !! This is a bug in Gregorio.  Please report it at https://github.com/gregorio-project/gregorio/issues}}%


\ifx\csname gre@debug\endcsname\relax%
\else%
  \def\gre@debug{}%
\fi%

\ifx\csname f@size\endcsname\relax%
\else%
  \def\f@size{\directlua{gregoriotex.font_size()}}%
\fi%

\input gregoriotex-main.tex

%% The following two functions are defined for backwards compatibility.  They will eventually be removed.
\def\greinitialformat#1{%
  {\grefontofinitial #1}%
  \relax %
}%

\def\grebiginitialformat#1{%
  {\grefontofgrebiginitial #1}%
  \relax %
}

%%%%%%%%%%%%%%%%%%%%
%% Formatting environments
%%%%%%%%%%%%%%%%%%%%

\font\gre@fontofbiginitial=pncr at 80pt%
\font\gre@fontofinitial=pncr at 40pt%

\def\gre@format@initial{%
  \begingroup%
  \gre@fontofinitial%
  \relax %
}%
\def\endgre@format@initial{\endgroup}%

\def\gre@format@biginitial{%
  \begingroup%
  \gre@fontofbiginitial%
  \relax %
}%
\def\endgre@format@biginitial{\endgroup}%

\def\gre@format@translation{%
  \begingroup%
  \it%
}%
\def\endgre@format@translation{\endgroup}%

\def\gre@format@abovelinestext{%
  \begingroup%
  \it%
}%
\def\endgre@format@abovelinestext{\endgroup}%

\def\gre@format@normalstafflines{%
  \begingroup%
  \relax%
}%
\def\endgre@format@normalstafflines{\endgroup}%

\def\gre@format@additionalstafflines{%
  \begingroup%
  \gre@format@normalstafflines%
}%
\def\endgre@format@additionalstafflines{%
  \endgre@format@normalstafflines%
  \endgroup%
}%

\def\gre@format@lowchoralsign{%
  \begingroup%
  \relax%
}%
\def\endgre@format@lowchoralsign{\endgroup}%

\def\gre@format@highchoralsign{%
  \begingroup%
  \relax%
}%
\def\endhighlowchoralsignformat{\endgroup}%

\def\gre@changeformat#1#2[#3]{%
  \gdef\csname gre@format@#1\endcsname{\begingroup#2}%
  \gdef\csname endgre@format@#1\endcsname{#3\endgroup}%
}%


\catcode`\@=\greoldcatcode
